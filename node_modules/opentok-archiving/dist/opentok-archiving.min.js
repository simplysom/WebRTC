var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};(function(){var e=void 0;e="object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?require("jquery"):this.$;var n=void 0,i=void 0,t=void 0,o=void 0,r=!1,c=!1,s=void 0,a=void 0,d=function(e,n){s&&s.triggerEvent(e,n)},l=function(){return['<div id="otsArchivingModal" class="ots-archiving-modal">','<div class="modal-content">','<div class="modal-header">',"<h2>Archive is being prepared</h2>",'<span id="closeArchiveModal" class="close-button"></span>',"</div>",'<div class="modal-info">',"<span class=\"message\"> Your session archive file is now being prepared. You'll recieve a notification as soon as it's ready.  Please be patient, this won't take long.</span>","</div>",'<div class="modal-buttons">','<div id="closeArchiveModalBtn" class="btn ok" target="_blank">Ok, Thanks!</div>',"</div>","</div>","</div>"].join("\n")},v=function(e){var n=new Date(null);n.setSeconds(e.duration);var i=n.toISOString().substr(11,8),t=(e.size/1e6).toString().slice(0,5)+"mb";return['<div id="otsArchivingModal" class="ots-archiving-modal">','<div class="modal-content">','<div class="modal-header">',"<h2>Archive is ready</h2>",'<span id="closeArchiveModal" class="close-button"></span>',"</div>",'<div class="modal-info">','<span class="archive-id">'+e.id+"</span>",'<div class="archive-details">Archive details: '+i+" / "+t+"</div>","</div>",'<div class="modal-buttons">','<a href="'+e.url+'" class="btn download" target="_blank">Download Archive</a>',"</div>","</div>","</div>"].join("\n")},u=function(e){var n=document.getElementById("otsArchivingModal");n&&n.remove();var i=e?v(e):l(),t=document.querySelector("#otsWidget")||document.body,o=document.createElement("div");o.innerHTML=i;var r=o.firstChild;t.appendChild(r);var c=document.getElementById("closeArchiveModal"),s=document.getElementById("closeArchiveModalBtn");c.onclick=function(){return r.remove()},s&&(s.onclick=function(){return r.remove()})},f=function(){e.post(n,{sessionId:a.id}).then(function(e){t=e,d("startArchive",e)}).fail(function(e){d("archiveError",e)})},h=function(){d("stopArchive"),u(),e.post(i,{archiveId:t.id}).then(function(e){u(e),d("archiveReady",e)}).fail(function(e){d("archiveError",e)})},m=function(e){var n=document.querySelector(e),i=document.createElement("div");i.innerHTML='<div class="ots-video-control circle archiving enabled" id="enableArchiving"></div>';var t=i.firstChild;n.appendChild(t),c=!0,t.onclick=function(){r?(r=!1,document.querySelector("#enableArchiving").classList.remove("active"),h()):(r=!0,document.querySelector("#enableArchiving").classList.add("active"),f())}},p=function(){var e=["startArchive","stopArchive","archiveReady","archiveError"];s.registerEvents(e)},y=function(){s.registerEventListener("startCall",function(){c?document.getElementById("enableArchiving").classList.remove("ots-hidden"):o&&m()}),s.registerEventListener("endCall",function(){o&&document.getElementById("enableArchiving").classList.add("ots-hidden")})},g=function(e){["session","startURL","stopURL"].forEach(function(n){if(!e[n])throw new Error(["OT: Archiving Accelerator Pack requires a",n].join(""))}),a=e.session,n=e.startURL,i=e.stopURL,s=e.accPack,o=!e.hasOwnProperty("appendControl")||e.appendControl},b=function(e){g(e);var n=e.controlsContainer||"#feedControls";o&&m(n),p(),y()};b.prototype={constructor:b,start:f,stop:h},"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=b:"function"==typeof define&&define.amd?define(function(){return b}):this.ArchivingAccPack=b}).call(this);